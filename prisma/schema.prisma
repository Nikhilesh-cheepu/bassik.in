// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String        @id // Clerk user ID
  email         String        @unique
  firstName     String?
  lastName      String?
  imageUrl      String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  reservations Reservation[]

  @@index([email])
}

model Venue {
  id             String   @id @default(cuid())
  brandId        String   @unique // Matches brand.id from brands.ts
  name           String
  shortName      String
  address        String
  mapUrl         String?
  contactPhone   String?  // Override for call/WhatsApp (defaults from outlet-contacts)
  coverVideoUrl  String?  // Optional cover video (e.g. for The Hub); when set, used instead of cover image
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  images       VenueImage[]
  menus        Menu[]
  reservations Reservation[]

  @@index([brandId])
}

model VenueImage {
  id        String    @id @default(cuid())
  venueId   String
  url       String
  type      ImageType // COVER or GALLERY
  order     Int       @default(0) // For ordering images
  createdAt DateTime  @default(now())

  venue Venue @relation(fields: [venueId], references: [id], onDelete: Cascade)

  @@index([venueId, type])
  @@index([venueId, type, order])
}

enum ImageType {
  COVER
  GALLERY
}

model Menu {
  id           String   @id @default(cuid())
  venueId      String
  name         String // "Food Menu" or "Liquor Menu"
  thumbnailUrl String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  venue  Venue       @relation(fields: [venueId], references: [id], onDelete: Cascade)
  images MenuImage[]

  @@index([venueId])
}

model MenuImage {
  id        String   @id @default(cuid())
  menuId    String
  url       String
  order     Int      @default(0) // For ordering menu pages
  createdAt DateTime @default(now())

  menu Menu @relation(fields: [menuId], references: [id], onDelete: Cascade)

  @@index([menuId, order])
}

model Reservation {
  id                String            @id @default(cuid())
  venueId           String
  brandId           String // Keep for quick lookup
  brandName         String
  fullName          String
  contactNumber     String
  numberOfMen       String
  numberOfWomen     String
  numberOfCouples   String
  date              String
  timeSlot          String
  notes             String?
  selectedDiscounts String? // JSON array of discount IDs
  status            ReservationStatus @default(PENDING)
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt

  userId String? // Clerk user ID - optional for backward compatibility
  user   User?   @relation(fields: [userId], references: [id], onDelete: SetNull)

  venue Venue @relation(fields: [venueId], references: [id], onDelete: Cascade)

  @@index([venueId])
  @@index([brandId])
  @@index([date])
  @@index([status])
  @@index([createdAt])
  @@index([userId])
}

enum ReservationStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}
